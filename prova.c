#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#define CMD_LEN 200
#include <stdio.h>
#include <stdlib.h>

//-------------------- Liste  semplici (single linked)  -----------------------------------//
// Definisco la struttura di un Nodo
typedef struct Nodo
{
	char nome_ingrediente[CMD_LEN];
	int qta;
	int scadenza;
	struct Nodo *successore;
} Nodo;

// ---------------------------  HASH TABLE ---------------------------------------------//

// Definisco la struttura della hash table
typedef struct Bucket
{
	char string[CMD_LEN];
	struct Nodo *lista;
	struct Bucket *successore;
} Bucket;

typedef struct HashTable
{
	int dimensione;
	int num_buckets_inseriti;
	Bucket **buckets;
} HashTable;

// crea HashTable
void crea_ht(HashTable *ht)
{
	ht->dimensione = 1e9 + 9;
	ht->num_buckets_inseriti = 0;
	ht->buckets = (Bucket **)malloc(sizeof(struct Bucket *) * ht->dimensione);
}

// crea Bucket
Bucket *crea_bucket(char *string, Nodo *lista)
{
	Bucket *nuovo_bucket = (Bucket *)malloc(sizeof(Bucket));
	nuovo_bucket->successore = NULL;
	strcpy(nuovo_bucket->string, string);
	nuovo_bucket->lista = lista;
	return nuovo_bucket;
}

// funzione di hash: uso rolling polinomial con p = 53 e dimensione = 1e9 + 9
int hash(char *string)
{
	// vettore con valori di potenze di p precalcolati per aumentare efficienza. Calcolati fino a p ^CMD_LEN = 256
	int p_pow[] = {31, 961, 29791, 923521, 28629151, 887503681, 512613868, 891029773, 621922720, 279604149, 667728547, 699584777, 687127898, 300964649, 329904038, 227025088, 37777665, 171107606, 304335741, 434407890, 466644473, 465978537, 445334521, 805370034, 966470838, 960595717, 778466966, 132475730, 106747594, 309175387, 584436916, 117544234, 643871227, 960007866, 760243585, 567550928, 594078615, 416436903, 909543885, 195860183, 71665619, 221634171, 870659247, 990436423, 703528843, 809393944, 91212039, 827573191, 654768696, 297829396, 232711195, 214046982, 635456388, 699147857, 673583378, 881084538, 313620435, 722233404, 389235326, 66294998, 55144920, 709492511, 994267652, 822296942, 491204977, 227354152, 47978649, 487338110, 107481275, 331919498, 289504348, 974634716, 213675926, 623953652, 342563041, 619454181, 203079440, 295462586, 159340085, 939542599, 125820308, 900429521, 913314908, 312761896, 695618695, 564179356, 489559883, 176356238, 467043333, 478343197, 828638981, 687808186, 322053577, 983660806, 493484716, 298026061, 238807810, 403042047, 494303349, 323403684, 25514114, 790937534, 519063338, 90963334, 819863336, 415763191, 888658813, 548422960, 1111607, 34459817, 68254318, 115883840, 592399013, 364369241, 295446372, 158837451, 923960945, 642789043, 926460162, 720264770, 328207672, 174437742, 407569957, 634668559, 674725158, 916479718, 410871006, 737001078, 847033220, 258029586, 998917103, 966429923, 959327352, 739147651, 913576983, 320886221, 947472770, 371655609, 521323780, 161037036, 992148080, 756590210, 454296303, 83185267, 578743259, 941040876, 172266895, 340273700, 548484610, 3022757, 93705467, 904869459, 50952977, 579542278, 965810465, 940124154, 143848513, 459303867, 238419751, 391012218, 121378650, 762738123, 644881606, 991329615, 731217795, 667751447, 700294677, 709134798, 983178549, 478534749, 834577093, 871889658, 28579155, 885953805, 464567712, 401598946, 449567218, 936583641, 34092610, 56870901, 762997922, 652935375, 240996445, 470889732, 597581566, 525028384, 275879760, 552272488, 120446975, 733856198, 749541940, 235799933, 309797860, 603733579, 715740787, 187964199, 826890124, 633593619, 641402018, 883462387, 387333754, 7346266, 227734246, 59761563, 852608444, 430861530, 356707313, 57926604, 795724715, 667465949, 691444239, 434771220, 477907703, 815138667, 269298452, 348251940, 795810050, 670111334, 773451174, 976986187, 286571527, 883717265, 395234972, 252284024, 820804681, 444944886, 793291349, 592031603, 352979531, 942365371, 213326240, 613113386, 6514795, 201958645, 260717941, 82256099, 549939051, 48110428, 491423259, 234120894, 257747651, 990177118, 695490388, 560201839, 366256856, 353962437, 972835457, 157898897, 894865771, 740838658, 965998200, 945943939, 324261848, 52117198, 615633129, 84626828};
	// long long p = 31;
	int m = 1e9 + 9;
	unsigned long long hash = 0;
	for (int i = 0; i < strlen(string); i++)
	{
		hash = (hash + (string[i] - 'a' + 1) * p_pow[i]) % m;
	}
	return hash;
}

int main()
{
	printf("Hash: %d\n", hash("farina"));
	return 0;
}